



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>Domains and Ports - pod-charlesreid1</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#domains-and-ports" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="pod-charlesreid1" class="md-header-nav__button md-logo">
          
            <i class="md-icon">dns</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                pod-charlesreid1
              </span>
              <span class="md-header-nav__topic">
                Domains and Ports
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon">dns</i>
      
    </span>
    pod-charlesreid1
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Running/" title="Running the Charlesreid1 Docker Pod" class="md-nav__link">
      Running the Charlesreid1 Docker Pod
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Volumes/" title="Volumes" class="md-nav__link">
      Volumes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Backups/" title="Backups (TODO)" class="md-nav__link">
      Backups (TODO)
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Domains and Ports
      </label>
    
    <a href="./" title="Domains and Ports" class="md-nav__link md-nav__link--active">
      Domains and Ports
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#domains" title="Domains" class="md-nav__link">
    Domains
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-domains" title="nginx domains" class="md-nav__link">
    nginx domains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ports" title="Ports" class="md-nav__link">
    Ports
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-ports" title="nginx ports" class="md-nav__link">
    nginx ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mediawikiapache-ports" title="mediawiki/apache ports" class="md-nav__link">
    mediawiki/apache ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phpmyadmin-ports" title="phpmyadmin ports" class="md-nav__link">
    phpmyadmin ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-ports" title="mysql ports" class="md-nav__link">
    mysql ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gitea-ports" title="gitea ports" class="md-nav__link">
    gitea ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-file-server-ports" title="python file server ports" class="md-nav__link">
    python file server ports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Secrets/" title="Secrets" class="md-nav__link">
      Secrets
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Service_mediawiki/" title="Pod Service: MediaWiki" class="md-nav__link">
      Pod Service: MediaWiki
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Service_apachephp/" title="Pod Service: Apache/PHP" class="md-nav__link">
      Pod Service: Apache/PHP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Service_mysql/" title="Pod Service: MySQL" class="md-nav__link">
      Pod Service: MySQL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Service_phpmyadmin/" title="Pod Service: phpMyAdmin" class="md-nav__link">
      Pod Service: phpMyAdmin
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Service_nginx/" title="Pod Service: nginx" class="md-nav__link">
      Pod Service: nginx
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Service_python/" title="Pod Service: Python HTTP Server" class="md-nav__link">
      Pod Service: Python HTTP Server
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Service_gitea/" title="Pod Service: Gitea" class="md-nav__link">
      Pod Service: Gitea
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#domains" title="Domains" class="md-nav__link">
    Domains
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-domains" title="nginx domains" class="md-nav__link">
    nginx domains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ports" title="Ports" class="md-nav__link">
    Ports
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-ports" title="nginx ports" class="md-nav__link">
    nginx ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mediawikiapache-ports" title="mediawiki/apache ports" class="md-nav__link">
    mediawiki/apache ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phpmyadmin-ports" title="phpmyadmin ports" class="md-nav__link">
    phpmyadmin ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-ports" title="mysql ports" class="md-nav__link">
    mysql ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gitea-ports" title="gitea ports" class="md-nav__link">
    gitea ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-file-server-ports" title="python file server ports" class="md-nav__link">
    python file server ports
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="domains-and-ports">Domains and Ports</h1>
<h2 id="domains">Domains</h2>
<p>There are three domains pointing to this server:</p>
<pre><code>charlesreid1.com
charlesreid1.red
charlesreid1.blue
</code></pre>

<p>These are pointing to the server's IP address
using an A NAME DNS record.</p>
<p>There are also various subdomains set up
(www, git, files), all pointing to the 
same location.</p>
<h3 id="nginx-domains">nginx domains</h3>
<p>Nginx handles all of the domains by specifying 
a different <code>domain_name</code> in each <code>server{}</code> block
of the nginx config files.</p>
<p>For example:</p>
<pre><code>server {
    listen 80;
    listen [::]:80;
    server_name charlesreid1.com;
    ...
}

server {
    listen 80;
    listen [::]:80;
    server_name charlesreid1.blue;
    ...
}

server {
    listen 80;
    listen [::]:80;
    server_name charlesreid1.red;
    ...
}
</code></pre>

<p>See the <code>conf.d</code> dir of
<a href="https://git.charlesreid1.com/docker/d-nginx-charlesreid1">d-nginx-charlesreid1</a>.</p>
<p>We will cover this in the nginx ports section,
but all http urls are redirected to https urls.</p>
<h2 id="ports">Ports</h2>
<h3 id="nginx-ports">nginx ports</h3>
<p>Nginx has two main public-facing ports:
port 80 (HTTP) and port 443 (HTTPS).</p>
<p>All requests to <code>http://</code> urls go to port 80,
and all requests to <code>https://</code> urls go to port 443.
The server will automatically redirect all 
requests to port 80 to port 443, turning all
http requests into https requests.</p>
<p>Nginx also exposes port 3000 and forwards it
along to <code>git.charlesreid1.com</code>. This is for 
legacy reasons.</p>
<h3 id="mediawikiapache-ports">mediawiki/apache ports</h3>
<p>The MediaWiki server runs on a PHP and Apache stack.
Inside the MediaWiki container, Apache listens on 
port 8989. This port only connects to the nginx container,
so nginx is the only service that can connect to MediaWiki,
and only over port 8989.</p>
<p>This nginx-apache connection is not encrypted 
because it happens on the same machine. </p>
<p>When the user connects to the wiki, for example at the url</p>
<pre><code>https://charlesreid1.com/wiki/Nmap
</code></pre>

<p>the user's connection is with the nginx server.
The session is an https session happening over port 443
and signed by nginx's certificates.</p>
<p>If the user goes to </p>
<pre><code>http://charlesreid1.com/wiki/Nmap
</code></pre>

<p>on port 80, this is rewritten to</p>
<pre><code>https://charlesreid1.com/wiki/Nmap
</code></pre>

<p>on port 443. In nginx, this is done with a 301:</p>
<pre><code>server {
    listen 80;
    listen [::]:80;
    server_name charlesreid1.com;
    location / {
        return 301 https://charlesreid1.com$request_uri;
    }
}
</code></pre>

<p>Note that nginx plays the role of a central dispatcher 
in the charlesreid1 pod - all containers connect to
nginx and only nginx, while nginx exposes each container 
to the outside world via requests for various subdomains 
being redirected to different ports.</p>
<h3 id="phpmyadmin-ports">phpmyadmin ports</h3>
<p>phpMyAdmin provides a web interface for MySQL databases.
Like the MediaWiki Apache container, </p>
<h3 id="mysql-ports">mysql ports</h3>
<p>The MySQL container listens on port 3306 by default.
The container is only bound to the MediaWiki container, 
so MediaWiki is the only service that can access MySQL.</p>
<h3 id="gitea-ports">gitea ports</h3>
<p>Requests for the subdomain <code>git.charlesreid1.com</code> 
are redirected to port 3000, where gitea is listening.</p>
<p>The gitea container configuration is similar to the 
Apache container configuration. Gitea listens on 3000
in the container, while Apache listens on port 8989 
in the container.</p>
<p>Gitea listens on 
port 3000 but is only connected to the nginx container,
and the nginx container intercepts any requests 
for <code>git.charlesreid1.com</code> and forwards them to 3000.</p>
<p>port 3000</p>
<p>like apache on port 8989</p>
<h3 id="python-file-server-ports">python file server ports</h3>
<p>We have a simple, lightweight Python HTTP server
that's run in a Docker container with the following
command:</p>
<pre><code>python -m http.server -b &lt;bind-address&gt; 8080
</code></pre>

<p>If there is no index.html, Python will 
provide a directory listing, and thus
a lightweight file server.</p>
<p>This is bound to a particular IP address -
in particular, the IP address of the 
Python file server container on the 
Docker private network. The 
<code>&lt;bind-address&gt;</code> piece above should
be replaced with the name of the container
(<code>stormy_files</code> in this case):</p>
<pre><code>python -m http.server -b stormy_files 8080
</code></pre>

<p>This listens on port 8080 inside the 
python file server container <code>stormy_files</code>.</p>
<p>The nginx server then runs a reverse proxy,
serving requests to <code>files.charlesreid1.com</code>
on the frontend to the python files container,
port 8080, on the backend.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Backups/" title="Backups (TODO)" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Backups (TODO)
              </span>
            </div>
          </a>
        
        
          <a href="../Secrets/" title="Secrets" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Secrets
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.0cf9b500.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
        <script src="../search/require.js"></script>
      
        <script src="../search/search.js"></script>
      
    
    
      
    
  </body>
</html>